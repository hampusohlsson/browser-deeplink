/**
 * browser-deeplink v0.1
 *
 * Author: Hampus Ohlsson, Nov 2014
 * GitHub: http://github.com/hampusohlsson/browser-deeplink
 *
 * MIT License
 */

!function(a,b){"function"==typeof define&&define.amd?define("deeplink",b(a)):"object"==typeof exports?module.exports=b(a):a.deeplink=b(a)}(window||this,function(a){"use strict";if(a.document&&a.navigator){var b,c={},d={iOS:{},android:{},androidDisabled:!1,fallback:!0,fallbackToWeb:!1,delay:1e3,delta:500},e=function(a,b){var c={};for(var d in a)c[d]=a[d];for(var d in b)c[d]=b[d];return c},f=function(){var a="itms-apps://itunes.apple.com/app/",b=c.iOS.appName,d=c.iOS.appId;return d&&b?a+b+"/id"+d+"?mt=8":null},g=function(){var a="market://details?id=",b=c.android.appId;return b?a+b:null},h=function(){var a={ios:c.iOS.storeUrl||f(),android:c.android.storeUrl||g()};return a[c.platform]},i=function(){var a={ios:c.iOS.fallbackWebUrl||location.href,android:c.android.fallbackWebUrl||location.href};return a[c.platform]},j=function(){return navigator.userAgent.match("Android")},k=function(){return navigator.userAgent.match("iPad")||navigator.userAgent.match("iPhone")||navigator.userAgent.match("iPod")},l=function(){return j()||k()},m=function(a){return function(){var b=c.fallbackToWeb?i():h(),d=c.delay+c.delta;"string"==typeof b&&Date.now()-a<d&&(window.location.href=b)}},n=function(a){c=e(d,a),j()&&(c.platform="android"),k()&&(c.platform="ios")},o=function(a){if(!l())return!1;if(!j()||!c.androidDisabled){if(j()&&!navigator.userAgent.match(/Firefox/)){var d=a.match(/([^:]+):\/\/(.+)$/i),e=["intent://"+d[2]+"#Intent","scheme="+d[1],"package="+c.android.appId];(function(){var a=navigator.userAgent.match,b=a.match(/Chrome\/(\d+)/);try{return parseInt(b[1])>=42}catch(c){return!1}})()&&e.push("S.browser_fallback_url="+encodeURIComponent(window.location.href)),a=e.join(";")+";end"}(c.fallback||c.fallbackToWeb)&&(b=setTimeout(m(Date.now()),c.delay));var f=window.navigator.userAgent;if(f.match(/CriOS/)||k()&&f.match(/Safari/)&&function(){var a=f.match(/Version\/(\d+)/);try{return parseInt(a[1])>=9}catch(b){return!1}}()||j()&&function(){var a=f.match(/Chrome\/(\d+)/);try{return parseInt(a[1])>=42}catch(b){return!1}}())window.location.href=a;else{var g=document.createElement("iframe");g.onload=function(){clearTimeout(b),g.parentNode.removeChild(g),window.location.href=a},g.src=a,g.setAttribute("style","display:none;"),document.body.appendChild(g)}return!0}};return{setup:n,open:o}}});